<!doctype html>
<html>
	<head>
		<meta charset="utf8">
		<title>Schach Test</title>
		<style>
			*
			{
				padding: 0;
				margin: 0;
				border-width: 0 !important;
				border-style: none !important;
				border-color: black;
			}
			.tile
			{
				width: 50px;
				height: 50px;
			}
			.white_tile
			{
				background-color: #EFE5CC
			}
			.black_tile
			{
				background-color: #700c0e
			}
			.selected
			{
				background-color: grey
			}
			td>img
			{
				margin-left: 2.5px;
				margin-right: 2.5px;
				width: 45px;
				height: 45px;
			}
		</style>
	</head>
	<body>
		<table>
			<tr>
				<td class="tile white_tile"><img src="white_rook.svg" alt="white rook" class="white"></td>
				<td class="tile black_tile"><img src="white_knight.svg" alt="white knight" class="white"></td>
				<td class="tile white_tile"><img src="white_bishop.svg" alt="white bishop" class="white"></td>
				<td class="tile black_tile"><img src="white_king.svg" alt="white king" class="white"></td>
				<td class="tile white_tile"><img src="white_queen.svg" alt="white queen" class="white"></td>
				<td class="tile black_tile"><img src="white_bishop.svg" alt="white bishop" class="white"></td>
				<td class="tile white_tile"><img src="white_knight.svg" alt="white knight" class="white"></td>
				<td class="tile black_tile"><img src="white_rook.svg" alt="white rook" class="white"></td>
			</tr>
			<tr>
				<td class="tile black_tile"><img src="white_pawn.svg" alt="white pawn" class="white"></td>
				<td class="tile white_tile"><img src="white_pawn.svg" alt="white pawn" class="white"></td>
				<td class="tile black_tile"><img src="white_pawn.svg" alt="white pawn" class="white"></td>
				<td class="tile white_tile"><img src="white_pawn.svg" alt="white pawn" class="white"></td>
				<td class="tile black_tile"><img src="white_pawn.svg" alt="white pawn" class="white"></td>
				<td class="tile white_tile"><img src="white_pawn.svg" alt="white pawn" class="white"></td>
				<td class="tile black_tile"><img src="white_pawn.svg" alt="white pawn" class="white"></td>
				<td class="tile white_tile"><img src="white_pawn.svg" alt="white pawn" class="white"></td>
			</tr>
			<tr>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
			</tr>
			<tr>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
			</tr>
			<tr>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
			</tr>
			<tr>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
				<td class="tile black_tile"></td>
				<td class="tile white_tile"></td>
			</tr>
			<tr>
				<td class="tile white_tile"><img src="black_pawn.svg" alt="black pawn" class="black"></td>
				<td class="tile black_tile"><img src="black_pawn.svg" alt="black pawn"class="black"></td>
				<td class="tile white_tile"><img src="black_pawn.svg" alt="black pawn"class="black"></td>
				<td class="tile black_tile"><img src="black_pawn.svg" alt="black pawn"class="black"></td>
				<td class="tile white_tile"><img src="black_pawn.svg" alt="black pawn"class="black"></td>
				<td class="tile black_tile"><img src="black_pawn.svg" alt="black pawn"class="black"></td>
				<td class="tile white_tile"><img src="black_pawn.svg" alt="black pawn"class="black"></td>
				<td class="tile black_tile"><img src="black_pawn.svg" alt="black pawn"class="black"></td>
			</tr>
			<tr>
				<td class="tile black_tile"><img src="black_rook.svg" alt="black rook"class="black"></td>
				<td class="tile white_tile"><img src="black_knight.svg" alt="black knight"class="black"></td>
				<td class="tile black_tile"><img src="black_bishop.svg" alt="black bishop"class="black"></td>
				<td class="tile white_tile"><img src="black_king.svg" alt="black king"class="black"></td>
				<td class="tile black_tile"><img src="black_queen.svg" alt="black queen"class="black"></td>
				<td class="tile white_tile"><img src="black_bishop.svg" alt="black bishop"class="black"></td>
				<td class="tile black_tile"><img src="black_knight.svg" alt="black knight"class="black"></td>
				<td class="tile white_tile"><img src="black_rook.svg" alt="black rook"class="black"></td>
			</tr>
		</table>
	</body>
	<script>
		let tiles = document.getElementsByClassName("tile");
		
		let selected_tile = undefined;
		let current_player = "white";
		for(let i = 0; i < tiles.length; ++i)
		{
			tiles[i].is_reachable =
			function(tile)
			{
				if(tile.firstChild.alt.includes("pawn"))
				{
					if(!this.hasChildNodes())
					{
						if(tile.firstChild.alt.includes("black"))
						{
							return tile.position.column === this.position.column &&
							       (tile.position.row - this.position.row === 1 ||
											tile.position.row === 6 &&
											tile.position.row - this.position.row === 2);
						}
						else
						{
							return tile.position.column === this.position.column &&
								     (tile.position.row - this.position.row === -1 ||
							        tile.position.row === 1 &&
							        tile.position.row - this.position.row === -2);
						}
					}
					else
					{
						if(tile.firstChild.alt.includes("black"))
						{
							return Math.abs(tile.position.column - this.position.column) === 1 &&
							       tile.position.row - this.position.row === 1;
						}
						else
						{
							return Math.abs(tile.position.column - this.position.column) === 1 &&
							       tile.position.row - this.position.row === -1;
						}
					}
				}
				else if(tile.firstChild.alt.includes("rook"))
				{
					return true;
				}
				else if(tile.firstChild.alt.includes("knight"))
				{
					return true;
				}
				else if(tile.firstChild.alt.includes("bishop"))
				{
					return true;
				}
				else if(tile.firstChild.alt.includes("king"))
				{
					return true;
				}
				else if(tile.firstChild.alt.includes("queen"))
				{
					return true;
				}
				else
				{
					console.error("This should never happen.");
					console.error(tile);
					return false;
				}
			}
			tiles[i].position = {"row" : Math.floor(i / 8), "column" : i % 8};
			tiles[i].addEventListener(
				"click",
				function()
				{
					if(selected_tile === this)
					{
						this.classList.remove("selected");
						selected_tile = undefined;
						return;
					}

					if(selected_tile !== undefined)
					{
						if(this.childElementCount != 0)
						{
							if(selected_tile.firstChild.classList[0] === this.firstChild.classList[0])
							{
								selected_tile.classList.remove("selected");
								selected_tile = this;
								selected_tile.classList.add("selected");
								return;
							}

							if(!this.is_reachable(selected_tile))
							{
								return;
							}
							this.removeChild(this.firstChild);
							this.appendChild(selected_tile.firstChild);

							selected_tile.classList.remove("selected");
							selected_tile = undefined;
							current_player = current_player === "white" ? "black" : "white";
							return;
						}

						if(!this.is_reachable(selected_tile))
						{
							return;
						}
						this.appendChild(selected_tile.firstChild);

						selected_tile.classList.remove("selected");
						selected_tile = undefined;
						current_player = current_player === "white" ? "black" : "white";
						return;
					}

					if(
						this.childElementCount
						&& this.firstChild.classList.contains(current_player))
					{
						this.classList.add("selected");
						selected_tile = this;
					}
				});
		}
	</script>
</html>
